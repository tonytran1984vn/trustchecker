# TrustChecker Alertmanager Configuration
# Routes alerts from Prometheus → webhook (extensible to Slack/Email)

global:
  resolve_timeout: 5m

route:
  receiver: "webhook-default"
  group_by: ["alertname", "severity"]
  group_wait: 10s
  group_interval: 5m
  repeat_interval: 4h

  routes:
    # Critical alerts — shorter repeat
    - match:
        severity: critical
      receiver: "webhook-critical"
      repeat_interval: 1h

receivers:
  # Default receiver — all alerts
  - name: "webhook-default"
    webhook_configs:
      - url: "http://app:4000/api/webhooks/alert"
        send_resolved: true

  # Critical receiver — can add Slack/PagerDuty here
  - name: "webhook-critical"
    webhook_configs:
      - url: "http://app:4000/api/webhooks/alert"
        send_resolved: true
    # Uncomment for Slack:
    # slack_configs:
    #   - api_url: "https://hooks.slack.com/services/YOUR/SLACK/WEBHOOK"
    #     channel: "#trustchecker-alerts"
    #     title: '{{ .GroupLabels.alertname }}'
    #     text: '{{ range .Alerts }}{{ .Annotations.summary }}{{ end }}'

inhibit_rules:
  # If a service is down, suppress latency/error alerts for it
  - source_match:
      alertname: ServiceDown
    target_match_re:
      alertname: "High.*|Critical.*"
    equal: ["job"]
